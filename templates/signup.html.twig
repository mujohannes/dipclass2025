<!DOCTYPE html>
<html lang="en">
{% include 'partials/head.html.twig' %}

<body>
    {% include 'partials/navbar.html.twig' %}
    <div class="container mt-4">
        <h2 class="text-center">{{message}}</h2>
        <div class="row">
            <div class="col-md-4 offset-md-4">
                <form id="signup" class="mt-4" action="/signup.php" method="post" novalidate>
                    <div class="mb-3">
                        <label for="username" class="form-label">Username</label>
                        <input name="username" type="text" class="form-control" id="username" placeholder="maximum 16 characters"
                            minlength="3" maxlength="16">

                    </div>
                    <div class="mb-3">
                        <label for="email" class="form-label">Email address</label>
                        <input name="email" type="email" class="form-control" id="email" placeholder="name@example.com">
                        <div class="invalid-feedback">
                            please enter a valid email address
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="password" class="form-label">Password</label>
                        <input name="password" type="password" class="form-control" id="password" placeholder="minimum 8 characters">
                        <div class="invalid-feedback">
                            password has to be at least 8 characters
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="confirm-password" class="form-label">Confirm Password</label>
                        <input name="confirm-password" type="password" class="form-control" id="confirm-password"
                            placeholder="confirm your password">
                        <div class="invalid-feedback">
                            passwords don't match
                        </div>
                    </div>
                    <div class="mb-3">
                        <button type="submit" class="btn btn-primary w-100">Sign up</button>
                        <!-- <button type="reset">Reset</button> -->
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script>
        // javascript for form validation
        // create reference to form
        const form = document.querySelector("#signup")
        // listen for changes in the form
        form.addEventListener('input', function( event ) {  
            const element = event.target
            const val = event.target.value
            
        } )
        // when form is submitted
        form.addEventListener('submit', function(event) { 
            event.preventDefault()
            // a number of errors
            let errors = { username: 0, email: 0, password1: 0, password2: 0}
            const data = new FormData(form)
            // check if first password is at least 8 characters
            const password1 = data.get("password")
            if( password1.length < 8 ) { 
                document.querySelector("#password").classList.add("is-invalid")
                errors.password1 = 1
            }
            else {
                document.querySelector("#password").classList.remove("is-invalid")
                document.querySelector("#password").classList.add("is-valid")
                errors.password1 = 0
            }
            // check if first and second password fields are the same
            const password2 = data.get("confirm-password")
            if( password2 != password1 ) {
                document.querySelector("#confirm-password").classList.add("is-invalid")
                errors.password2 = 1
            }
            else {
                document.querySelector("#confirm-password").classList.remove("is-invalid")
                document.querySelector("#confirm-password").classList.add("is-valid")
                errors.password2 = 0
            }
            // check if email contains errors
            const email = data.get("email")
            if( email.indexOf('@') == 0 || 
                email.indexOf('@') == email.length -1 || 
                email.indexOf('@') == -1 ) 
            {
                document.querySelector("#email").classList.add("is-invalid")
                errors.email = 1
            }
            else {
                document.querySelector("#email").classList.remove("is-invalid")
                document.querySelector("#email").classList.add("is-valid")
                errors.email = 0
            }
            // check if username has value of more than 3 characters and less than 16
            const username = data.get("username")
            if( username.length < 3 || username.length > 16 ) {
                document.querySelector("#username").classList.add("is-invalid")
                errors.username = 1
            }
            else {
                document.querySelector("#username").classList.remove("is-invalid")
                document.querySelector("#username").classList.add("is-valid")
                errors.username = 0
            }
            // submit if there are no errors
            if( 
                errors.username == 0 && 
                errors.password1 == 0 &&
                errors.password2 == 0 &&
                errors.email == 0
            )
            {
                // form.submit()
                const url = "/signup.php"
                const request = fetch(url, {method: "POST"})
            }
        })
    </script>
</body>

</html>